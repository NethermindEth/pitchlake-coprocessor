#[cfg(test)]
mod tests {
    use crate::fixed_point::mrjpdf as mrjpdf_fixed;
    use crate::floating_point::mrjpdf as mrjpdf_floating;
    use nalgebra::DVector;
    use simba::scalar::FixedI48F16;

    #[test]
    fn test_test() {
        let xxx = 1;
        let yyy = 1;
        let zzz = xxx + yyy;
        assert_eq!(zzz, 3);
    }

    #[test]
    fn test_mrjpdf_floating() {
        let param = [
            -0.006246375006242974,
            0.02831079656483227,
            0.021424040730373572,
            0.003987449179574602,
            -0.0034206238557017155,
            0.21146713832539435,
        ];

        let pt_data = vec![
            0.001062712946239941,
            -0.11018575276745679,
            0.0015428760523192864,
            0.10818392714770653,
            0.03140804563764377,
            0.03370014434236168,
            -0.0838842283245782,
            0.029790006418625836,
            -0.020164067509451655,
            -0.05940298662369159,
            -0.17536409226786276,
            -0.05769855119273615,
            0.05806143009870368,
            0.08717677840431648,
            0.05346993014810408,
            0.00910674802409872,
            0.05449550886256915,
            0.01635519740835889,
            0.02872704698406281,
            0.009563246885743837,
            0.038423058682873545,
            0.011579215762804296,
            -0.0223687639227812,
            -0.006721483143618201,
            -0.04599813204755776,
            0.04908457704320668,
            0.016392471703483125,
            -0.0006720780678080018,
            -0.0018241591584491346,
            -0.044005138444727976,
            0.006980418583932391,
            0.014148936684488689,
            -0.009409376510063794,
            -0.039350410517691614,
            -0.050725298648174544,
            -0.08327320077031075,
            0.03522916548048727,
            0.05217221201541733,
            -0.0021124903275691054,
            -0.028859171057774802,
            -0.05751890256808778,
            0.0389660507730305,
            0.0033663652771416253,
            -0.02668207678118506,
            0.02565356368818783,
            0.04541507428656644,
            0.017084291704176024,
            0.012049834837906559,
            -0.016295846781261503,
            0.014990597181974152,
            -0.006259606663345352,
            -0.025120872615058687,
            0.016937434189536305,
            -0.023935392268203515,
            -0.09223362353407794,
            0.026265512693331772,
            0.010553317288753306,
            -0.013344353461842928,
            0.027487327559562402,
            -0.008515271277452996,
            0.0010119094123126615,
            0.07829464298121991,
            0.08524169311223773,
            0.03674437747153547,
            -0.006268129871543238,
            -0.016717485360711493,
            -0.014728203921976046,
            0.03237833252362776,
            -0.02057649715434451,
            -0.05637134919613018,
            0.05086314943301318,
            0.025656023827380636,
            -0.017000350903128236,
            -0.026555760478021995,
            0.00879920085813879,
            -0.11266623356531014,
            0.005982758998925419,
            -0.03704569114005807,
            0.08050444201218454,
            0.029928856521124203,
            0.0005911494064427814,
            -0.028891462400576273,
            0.0035358770669091655,
            -0.00931800771734359,
            0.008881146216495495,
            -0.01433541837411667,
            -0.037960074824589185,
            -0.05720971752792181,
            0.05948272779624375,
            0.060171287041814736,
            -0.003784926926009291,
            0.014933603068879364,
            5.3202599421098284e-5,
            0.03430841072389512,
            -0.025800045117001957,
            -0.05207302577075268,
            -0.09963840358181741,
            0.01587949504120445,
            -0.03498944095389689,
            -0.07339544404675635,
            0.042490914658198875,
            0.08707300225368897,
            0.11206053572733055,
            0.045532222191404514,
            -0.06467422314788962,
            -0.11267325665325245,
            -0.21381126392964234,
            -0.09723187780269171,
            0.020338524434631466,
            0.12771712690625492,
            0.10302377475993296,
            0.054224447931758846,
            0.0069704115581679105,
            -0.0006625563480469054,
            0.040547767004962765,
            0.040661504065926835,
            0.04969198981485334,
            0.09058651829065667,
            0.07022699864994308,
            0.06817428896085076,
            0.037517796117359836,
            -0.060552171888016204,
            0.056109798605696426,
            0.020161595277265576,
            0.01957808162361374,
            -0.025241217925902504,
            -0.03316322800777982,
            -0.14448460306449462,
            -0.02603298642821983,
            -0.14696816994968032,
            -0.2394927636855435,
            -0.11997694843595141,
            -0.001347022918739782,
            0.022926883869150316,
            -0.021254876683141077,
            0.04482668787512978,
            -0.006320642516968178,
            0.0918762397091264,
            0.05915277061136237,
            0.040751498343869486,
            0.0539582446975686,
            0.03386225980152702,
            0.026077289986748298,
            0.08426844340923978,
            0.04260889643319388,
            0.02582312708764789,
            -0.017612925414081104,
            -0.0029289458302912408,
            -0.016121148542055153,
            -0.03289186592933646,
            -0.028375590948115814,
            -0.0021996993727668723,
            0.012362382663141602,
            -0.02750399523682745,
            -0.028884143489740666,
            -0.1408576236336998,
            -0.024223862110432037,
            0.049686931416470514,
            0.042722633478863514,
            0.011941431285826809,
            0.0031921370698846374,
            0.03173840422951102,
            -0.0005777974996803437,
            -0.0640309155305161,
            0.05652593401608641,
            0.003129724678494483,
            0.0002000479649879594,
            -0.017731740736298462,
        ];
        let pt = DVector::from_vec(pt_data);

        let pt1_data = vec![
            0.044063231372664546,
            0.001062712946239941,
            -0.11018575276745679,
            0.0015428760523192864,
            0.10818392714770653,
            0.03140804563764377,
            0.03370014434236168,
            -0.0838842283245782,
            0.029790006418625836,
            -0.020164067509451655,
            -0.05940298662369159,
            -0.17536409226786276,
            -0.05769855119273615,
            0.05806143009870368,
            0.08717677840431648,
            0.05346993014810408,
            0.00910674802409872,
            0.05449550886256915,
            0.01635519740835889,
            0.02872704698406281,
            0.009563246885743837,
            0.038423058682873545,
            0.011579215762804296,
            -0.0223687639227812,
            -0.006721483143618201,
            -0.04599813204755776,
            0.04908457704320668,
            0.016392471703483125,
            -0.0006720780678080018,
            -0.0018241591584491346,
            -0.044005138444727976,
            0.006980418583932391,
            0.014148936684488689,
            -0.009409376510063794,
            -0.039350410517691614,
            -0.050725298648174544,
            -0.08327320077031075,
            0.03522916548048727,
            0.05217221201541733,
            -0.0021124903275691054,
            -0.028859171057774802,
            -0.05751890256808778,
            0.0389660507730305,
            0.0033663652771416253,
            -0.02668207678118506,
            0.02565356368818783,
            0.04541507428656644,
            0.017084291704176024,
            0.012049834837906559,
            -0.016295846781261503,
            0.014990597181974152,
            -0.006259606663345352,
            -0.025120872615058687,
            0.016937434189536305,
            -0.023935392268203515,
            -0.09223362353407794,
            0.026265512693331772,
            0.010553317288753306,
            -0.013344353461842928,
            0.027487327559562402,
            -0.008515271277452996,
            0.0010119094123126615,
            0.07829464298121991,
            0.08524169311223773,
            0.03674437747153547,
            -0.006268129871543238,
            -0.016717485360711493,
            -0.014728203921976046,
            0.03237833252362776,
            -0.02057649715434451,
            -0.05637134919613018,
            0.05086314943301318,
            0.025656023827380636,
            -0.017000350903128236,
            -0.026555760478021995,
            0.00879920085813879,
            -0.11266623356531014,
            0.005982758998925419,
            -0.03704569114005807,
            0.08050444201218454,
            0.029928856521124203,
            0.0005911494064427814,
            -0.028891462400576273,
            0.0035358770669091655,
            -0.00931800771734359,
            0.008881146216495495,
            -0.01433541837411667,
            -0.037960074824589185,
            -0.05720971752792181,
            0.05948272779624375,
            0.060171287041814736,
            -0.003784926926009291,
            0.014933603068879364,
            5.3202599421098284e-5,
            0.03430841072389512,
            -0.025800045117001957,
            -0.05207302577075268,
            -0.09963840358181741,
            0.01587949504120445,
            -0.03498944095389689,
            -0.07339544404675635,
            0.042490914658198875,
            0.08707300225368897,
            0.11206053572733055,
            0.045532222191404514,
            -0.06467422314788962,
            -0.11267325665325245,
            -0.21381126392964234,
            -0.09723187780269171,
            0.020338524434631466,
            0.12771712690625492,
            0.10302377475993296,
            0.054224447931758846,
            0.0069704115581679105,
            -0.0006625563480469054,
            0.040547767004962765,
            0.040661504065926835,
            0.04969198981485334,
            0.09058651829065667,
            0.07022699864994308,
            0.06817428896085076,
            0.037517796117359836,
            -0.060552171888016204,
            0.056109798605696426,
            0.020161595277265576,
            0.01957808162361374,
            -0.025241217925902504,
            -0.03316322800777982,
            -0.14448460306449462,
            -0.02603298642821983,
            -0.14696816994968032,
            -0.2394927636855435,
            -0.11997694843595141,
            -0.001347022918739782,
            0.022926883869150316,
            -0.021254876683141077,
            0.04482668787512978,
            -0.006320642516968178,
            0.0918762397091264,
            0.05915277061136237,
            0.040751498343869486,
            0.0539582446975686,
            0.03386225980152702,
            0.026077289986748298,
            0.08426844340923978,
            0.04260889643319388,
            0.02582312708764789,
            -0.017612925414081104,
            -0.0029289458302912408,
            -0.016121148542055153,
            -0.03289186592933646,
            -0.028375590948115814,
            -0.0021996993727668723,
            0.012362382663141602,
            -0.02750399523682745,
            -0.028884143489740666,
            -0.1408576236336998,
            -0.024223862110432037,
            0.049686931416470514,
            0.042722633478863514,
            0.011941431285826809,
            0.0031921370698846374,
            0.03173840422951102,
            -0.0005777974996803437,
            -0.0640309155305161,
            0.05652593401608641,
            0.003129724678494483,
            0.0002000479649879594,
        ];
        let pt1 = DVector::from_vec(pt1_data);

        let result = mrjpdf_floating(&param, &pt, &pt1);
        println!("{:?}", result);
    }

    // VecStorage { data: [7.836363258045129, 1.2844433685428371, 8.122138360249952, 0.9674314140208923, 7.32857076321764, 6.807886421537982, 2.296744024319956, 6.8874665544547655, 5.963885668459064, 3.5502782403424775, 0.14813981647187568, 3.8598401841379624, 3.5048335611999257, 1.7774434978929234, 4.445257923390741, 8.231674004837629, 4.071358085516123, 8.25533780553019, 7.337318232822745, 8.259883540970883, 6.115173652793697, 8.285269741681617, 5.815306995436658, 7.359558843782215, 4.227254342458487, 4.51927844281062, 8.250900291077922, 7.767488683857028, 7.716950761667777, 4.330401428852691, 8.2482128045617, 8.272095117958902, 7.016656499011071, 4.61563085003176, 4.022632241502831, 2.4342767187057492, 6.19054119926755, 4.424605219511556, 7.5745131925190226, 5.3174162580424715, 3.6574767767542, 5.787759688881397, 7.995408517681226, 5.475337070575847, 7.528558543785632, 5.24187665914034, 8.229499630727918, 8.290374369439492, 6.365778810611484, 8.239389075837275, 7.306165524878184, 5.624644044252897, 8.161982409481666, 5.6687588718875235, 2.0002633497886353, 7.270637493980171, 8.2778225445837, 6.650699232336496, 7.379827094705641, 7.065340241304756, 7.933143452447855, 2.140199146386327, 1.8950354386476944, 6.616259922396484, 7.249490022711997, 6.374920778281133, 6.592150254738205, 6.809829089196011, 5.920724529761353, 3.7036952005765666, 4.273562697637066, 7.731634742392275, 6.263595540448563, 5.53188908673836, 8.274152506799478, 1.196048442112058, 8.267953283882587, 4.731927959813476, 1.9675898281575424, 7.402475614651635, 7.831321914036365, 5.309115906394068, 8.107612802921786, 7.053614291069559, 8.267465135322045, 6.56043059633945, 4.710502042387331, 3.686148414978813, 3.372168749641883, 3.623052489979178, 7.412557018628273, 8.249985466109099, 7.8232709703174255, 6.619355417839852, 5.475819199558621, 3.931901296958917, 1.726976527247508, 8.112664387378832, 4.846617536244208, 2.881638755619232, 5.257670170880954, 1.762183542290554, 0.9273324583222667, 5.551053257575086, 3.1961658632018954, 1.263571279083413, 0.02646861759886898, 2.016448425183205, 7.8251212152644, 0.5351817847369704, 1.2355789851657761, 4.408783188767737, 8.156106867847246, 7.7878617329450055, 5.791511453007056, 5.932911177747087, 4.746578841613112, 1.618596137299096, 2.8233354418588625, 2.9373134165461394, 6.453970529069855, 3.411359720699281, 3.6897094719479675, 8.119047825883607, 8.096799395750013, 5.554569421521883, 5.04996688419631, 0.46859152541270377, 5.881103471717246, 0.4268190223675798, 0.006909259286850983, 1.1870676725091969, 7.982660204869667, 7.835133704005696, 5.884491254314773, 5.14494519624874, 7.223734858199707, 1.5023079672335324, 3.821037208114201, 5.991486398797017, 4.233640780345255, 6.866668548593469, 7.651265625008968, 1.8707604547652261, 5.83762860005425, 7.696520459159446, 6.206223087582549, 7.6682543021667575, 6.422350312089218, 5.050892503228187, 5.422461717405796, 7.7480309001459275, 8.288532799635917, 5.390373989686347, 5.370814725530917, 0.5278996668160921, 6.033120798397927, 4.5209848337353415, 5.690888287984724, 8.28712130636927, 8.029471710513295, 6.950212596388248, 7.741999006472106, 3.292320315274493, 3.6378792458078157, 7.950672427947742, 7.857044542706573, 6.26259670929203], nrows: Dyn(168), ncols: Const }

    #[test]
    fn test_mrjpdf_fixed() {
        let param = [
            -0.006246375006242974,
            0.02831079656483227,
            0.021424040730373572,
            0.003987449179574602,
            -0.0034206238557017155,
            0.21146713832539435,
        ]
        .iter()
        .map(|x| FixedI48F16::from_num(*x))
        .collect::<Vec<_>>();

        let pt_data = vec![
            0.001062712946239941,
            -0.11018575276745679,
            0.0015428760523192864,
            0.10818392714770653,
            0.03140804563764377,
            0.03370014434236168,
            -0.0838842283245782,
            0.029790006418625836,
            -0.020164067509451655,
            -0.05940298662369159,
            -0.17536409226786276,
            -0.05769855119273615,
            0.05806143009870368,
            0.08717677840431648,
            0.05346993014810408,
            0.00910674802409872,
            0.05449550886256915,
            0.01635519740835889,
            0.02872704698406281,
            0.009563246885743837,
            0.038423058682873545,
            0.011579215762804296,
            -0.0223687639227812,
            -0.006721483143618201,
            -0.04599813204755776,
            0.04908457704320668,
            0.016392471703483125,
            -0.0006720780678080018,
            -0.0018241591584491346,
            -0.044005138444727976,
            0.006980418583932391,
            0.014148936684488689,
            -0.009409376510063794,
            -0.039350410517691614,
            -0.050725298648174544,
            -0.08327320077031075,
            0.03522916548048727,
            0.05217221201541733,
            -0.0021124903275691054,
            -0.028859171057774802,
            -0.05751890256808778,
            0.0389660507730305,
            0.0033663652771416253,
            -0.02668207678118506,
            0.02565356368818783,
            0.04541507428656644,
            0.017084291704176024,
            0.012049834837906559,
            -0.016295846781261503,
            0.014990597181974152,
            -0.006259606663345352,
            -0.025120872615058687,
            0.016937434189536305,
            -0.023935392268203515,
            -0.09223362353407794,
            0.026265512693331772,
            0.010553317288753306,
            -0.013344353461842928,
            0.027487327559562402,
            -0.008515271277452996,
            0.0010119094123126615,
            0.07829464298121991,
            0.08524169311223773,
            0.03674437747153547,
            -0.006268129871543238,
            -0.016717485360711493,
            -0.014728203921976046,
            0.03237833252362776,
            -0.02057649715434451,
            -0.05637134919613018,
            0.05086314943301318,
            0.025656023827380636,
            -0.017000350903128236,
            -0.026555760478021995,
            0.00879920085813879,
            -0.11266623356531014,
            0.005982758998925419,
            -0.03704569114005807,
            0.08050444201218454,
            0.029928856521124203,
            0.0005911494064427814,
            -0.028891462400576273,
            0.0035358770669091655,
            -0.00931800771734359,
            0.008881146216495495,
            -0.01433541837411667,
            -0.037960074824589185,
            -0.05720971752792181,
            0.05948272779624375,
            0.060171287041814736,
            -0.003784926926009291,
            0.014933603068879364,
            5.3202599421098284e-5,
            0.03430841072389512,
            -0.025800045117001957,
            -0.05207302577075268,
            -0.09963840358181741,
            0.01587949504120445,
            -0.03498944095389689,
            -0.07339544404675635,
            0.042490914658198875,
            0.08707300225368897,
            0.11206053572733055,
            0.045532222191404514,
            -0.06467422314788962,
            -0.11267325665325245,
            -0.21381126392964234,
            -0.09723187780269171,
            0.020338524434631466,
            0.12771712690625492,
            0.10302377475993296,
            0.054224447931758846,
            0.0069704115581679105,
            -0.0006625563480469054,
            0.040547767004962765,
            0.040661504065926835,
            0.04969198981485334,
            0.09058651829065667,
            0.07022699864994308,
            0.06817428896085076,
            0.037517796117359836,
            -0.060552171888016204,
            0.056109798605696426,
            0.020161595277265576,
            0.01957808162361374,
            -0.025241217925902504,
            -0.03316322800777982,
            -0.14448460306449462,
            -0.02603298642821983,
            -0.14696816994968032,
            -0.2394927636855435,
            -0.11997694843595141,
            -0.001347022918739782,
            0.022926883869150316,
            -0.021254876683141077,
            0.04482668787512978,
            -0.006320642516968178,
            0.0918762397091264,
            0.05915277061136237,
            0.040751498343869486,
            0.0539582446975686,
            0.03386225980152702,
            0.026077289986748298,
            0.08426844340923978,
            0.04260889643319388,
            0.02582312708764789,
            -0.017612925414081104,
            -0.0029289458302912408,
            -0.016121148542055153,
            -0.03289186592933646,
            -0.028375590948115814,
            -0.0021996993727668723,
            0.012362382663141602,
            -0.02750399523682745,
            -0.028884143489740666,
            -0.1408576236336998,
            -0.024223862110432037,
            0.049686931416470514,
            0.042722633478863514,
            0.011941431285826809,
            0.0031921370698846374,
            0.03173840422951102,
            -0.0005777974996803437,
            -0.0640309155305161,
            0.05652593401608641,
            0.003129724678494483,
            0.0002000479649879594,
            -0.017731740736298462,
        ]
        .iter()
        .map(|x| FixedI48F16::from_num(*x))
        .collect::<Vec<_>>();
        let pt = DVector::from_vec(pt_data);

        let pt1_data = vec![
            0.044063231372664546,
            0.001062712946239941,
            -0.11018575276745679,
            0.0015428760523192864,
            0.10818392714770653,
            0.03140804563764377,
            0.03370014434236168,
            -0.0838842283245782,
            0.029790006418625836,
            -0.020164067509451655,
            -0.05940298662369159,
            -0.17536409226786276,
            -0.05769855119273615,
            0.05806143009870368,
            0.08717677840431648,
            0.05346993014810408,
            0.00910674802409872,
            0.05449550886256915,
            0.01635519740835889,
            0.02872704698406281,
            0.009563246885743837,
            0.038423058682873545,
            0.011579215762804296,
            -0.0223687639227812,
            -0.006721483143618201,
            -0.04599813204755776,
            0.04908457704320668,
            0.016392471703483125,
            -0.0006720780678080018,
            -0.0018241591584491346,
            -0.044005138444727976,
            0.006980418583932391,
            0.014148936684488689,
            -0.009409376510063794,
            -0.039350410517691614,
            -0.050725298648174544,
            -0.08327320077031075,
            0.03522916548048727,
            0.05217221201541733,
            -0.0021124903275691054,
            -0.028859171057774802,
            -0.05751890256808778,
            0.0389660507730305,
            0.0033663652771416253,
            -0.02668207678118506,
            0.02565356368818783,
            0.04541507428656644,
            0.017084291704176024,
            0.012049834837906559,
            -0.016295846781261503,
            0.014990597181974152,
            -0.006259606663345352,
            -0.025120872615058687,
            0.016937434189536305,
            -0.023935392268203515,
            -0.09223362353407794,
            0.026265512693331772,
            0.010553317288753306,
            -0.013344353461842928,
            0.027487327559562402,
            -0.008515271277452996,
            0.0010119094123126615,
            0.07829464298121991,
            0.08524169311223773,
            0.03674437747153547,
            -0.006268129871543238,
            -0.016717485360711493,
            -0.014728203921976046,
            0.03237833252362776,
            -0.02057649715434451,
            -0.05637134919613018,
            0.05086314943301318,
            0.025656023827380636,
            -0.017000350903128236,
            -0.026555760478021995,
            0.00879920085813879,
            -0.11266623356531014,
            0.005982758998925419,
            -0.03704569114005807,
            0.08050444201218454,
            0.029928856521124203,
            0.0005911494064427814,
            -0.028891462400576273,
            0.0035358770669091655,
            -0.00931800771734359,
            0.008881146216495495,
            -0.01433541837411667,
            -0.037960074824589185,
            -0.05720971752792181,
            0.05948272779624375,
            0.060171287041814736,
            -0.003784926926009291,
            0.014933603068879364,
            5.3202599421098284e-5,
            0.03430841072389512,
            -0.025800045117001957,
            -0.05207302577075268,
            -0.09963840358181741,
            0.01587949504120445,
            -0.03498944095389689,
            -0.07339544404675635,
            0.042490914658198875,
            0.08707300225368897,
            0.11206053572733055,
            0.045532222191404514,
            -0.06467422314788962,
            -0.11267325665325245,
            -0.21381126392964234,
            -0.09723187780269171,
            0.020338524434631466,
            0.12771712690625492,
            0.10302377475993296,
            0.054224447931758846,
            0.0069704115581679105,
            -0.0006625563480469054,
            0.040547767004962765,
            0.040661504065926835,
            0.04969198981485334,
            0.09058651829065667,
            0.07022699864994308,
            0.06817428896085076,
            0.037517796117359836,
            -0.060552171888016204,
            0.056109798605696426,
            0.020161595277265576,
            0.01957808162361374,
            -0.025241217925902504,
            -0.03316322800777982,
            -0.14448460306449462,
            -0.02603298642821983,
            -0.14696816994968032,
            -0.2394927636855435,
            -0.11997694843595141,
            -0.001347022918739782,
            0.022926883869150316,
            -0.021254876683141077,
            0.04482668787512978,
            -0.006320642516968178,
            0.0918762397091264,
            0.05915277061136237,
            0.040751498343869486,
            0.0539582446975686,
            0.03386225980152702,
            0.026077289986748298,
            0.08426844340923978,
            0.04260889643319388,
            0.02582312708764789,
            -0.017612925414081104,
            -0.0029289458302912408,
            -0.016121148542055153,
            -0.03289186592933646,
            -0.028375590948115814,
            -0.0021996993727668723,
            0.012362382663141602,
            -0.02750399523682745,
            -0.028884143489740666,
            -0.1408576236336998,
            -0.024223862110432037,
            0.049686931416470514,
            0.042722633478863514,
            0.011941431285826809,
            0.0031921370698846374,
            0.03173840422951102,
            -0.0005777974996803437,
            -0.0640309155305161,
            0.05652593401608641,
            0.003129724678494483,
            0.0002000479649879594,
        ]
        .iter()
        .map(|x| FixedI48F16::from_num(*x))
        .collect::<Vec<_>>();
        let pt1 = DVector::from_vec(pt1_data);

        let result = mrjpdf_fixed(&param, &pt, &pt1);
        println!("{:?}", result);
    }
}
